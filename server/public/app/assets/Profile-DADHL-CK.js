const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/app-B9F_XcfL.js","assets/app-fluATIl5.css"])))=>i.map(i=>d[i]);
import{z as us,p as $,A as q,u as J,C as I,_ as ss,D as ts,q as R,x as es,E as ms,c as f,o as _,b as s,e as i,y as x,I as v,i as B,t as r,d as k,F as H,G,n as vs,g as j,H as fs,w as C,f as z,B as M,k as Y,j as _s,J as ps}from"./app-B9F_XcfL.js";import{I as N}from"./InputField-DS6hZIbH.js";import{B as Z}from"./BaseModal-D8J9ah1e.js";const ws=us("user",()=>{const F=$([]),l=$(!1),c=$(null);return{users:F,isLoading:l,error:c,updateProfile:async p=>{l.value=!0,c.value=null;try{const y=await q.put("/users/profile",p),b=J();b.user=y.data,localStorage.setItem("user",JSON.stringify(y.data));const{useNotificationStore:h}=await I(async()=>{const{useNotificationStore:E}=await import("./app-B9F_XcfL.js").then(d=>d.N);return{useNotificationStore:E}},__vite__mapDeps([0,1]));return h().addNotification({type:"success",title:"Готово!",message:"Профиль успешно обновлен."}),{success:!0,data:y.data}}catch(y){c.value=y.response?.data?.error||"Failed to update profile";const{useNotificationStore:b}=await I(async()=>{const{useNotificationStore:S}=await import("./app-B9F_XcfL.js").then(E=>E.N);return{useNotificationStore:S}},__vite__mapDeps([0,1]));return b().addNotification({type:"error",title:"Ошибка",message:c.value}),{success:!1,error:c.value}}finally{l.value=!1}},changeEmail:async(p,y)=>{l.value=!0,c.value=null;try{const b=await q.post("/users/change-email",{newEmail:p,currentPassword:y}),h=J();h.user.email=p,localStorage.setItem("user",JSON.stringify(h.user));const{useNotificationStore:S}=await I(async()=>{const{useNotificationStore:d}=await import("./app-B9F_XcfL.js").then(u=>u.N);return{useNotificationStore:d}},__vite__mapDeps([0,1]));return S().addNotification({type:"success",title:"Готово!",message:"Новый адрес электронной почты сохранен"}),{success:!0,data:b.data}}catch(b){c.value=b.response?.data?.error||"Failed to update profile";const{useNotificationStore:h}=await I(async()=>{const{useNotificationStore:E}=await import("./app-B9F_XcfL.js").then(d=>d.N);return{useNotificationStore:E}},__vite__mapDeps([0,1]));return h().addNotification({type:"error",title:"Ошибка",message:c.value}),{success:!1,error:c.value}}finally{l.value=!1}},getAllUsers:async()=>{l.value=!0,c.value=null;try{const p=await q.get("/users");return F.value=p.data,{success:!0,data:p.data}}catch(p){return c.value=p.response?.data?.error||"Failed to fetch users",{success:!1,error:c.value}}finally{l.value=!1}},updateUserRole:async(p,y)=>{l.value=!0,c.value=null;try{const b=await q.put(`/users/${p}/role`,{role:y}),h=F.value.findIndex(d=>d.id===p);h!==-1&&(F.value[h]=b.data);const{useNotificationStore:S}=await I(async()=>{const{useNotificationStore:d}=await import("./app-B9F_XcfL.js").then(u=>u.N);return{useNotificationStore:d}},__vite__mapDeps([0,1]));return S().addNotification({type:"success",title:"Готово!",message:`Роль пользователя обновлена ​​до ${y}`}),{success:!0,data:b.data}}catch(b){c.value=b.response?.data?.error||"Failed to update user role";const{useNotificationStore:h}=await I(async()=>{const{useNotificationStore:E}=await import("./app-B9F_XcfL.js").then(d=>d.N);return{useNotificationStore:E}},__vite__mapDeps([0,1]));return h().addNotification({type:"error",title:"Ошибка",message:c.value}),{success:!1,error:c.value}}finally{l.value=!1}}}}),hs={class:"profile-stats"},ys={class:"stats-header"},bs={class:"stats-refresh"},gs=["disabled","title"],$s={class:"stats-content"},Ps={class:"stats-section"},Ss={class:"stat-item"},Es={class:"stat-icon"},Vs={class:"stat-info"},Cs={class:"stat-value"},ks={class:"stat-item"},Us={class:"stat-icon"},Ns={class:"stat-info"},zs={class:"stat-value"},Ms={class:"stat-item"},Ls={class:"stat-icon"},xs={class:"stat-info"},Ds={class:"stat-value"},Fs={class:"stat-item"},Is={class:"stat-icon"},Rs={class:"stat-info"},As={class:"stat-value"},Ts={class:"stats-section"},Os={class:"stat-item"},js={class:"stat-icon"},Bs={class:"stat-info"},qs={class:"stat-value"},Js={class:"notification-count"},Hs={class:"stat-item"},Gs={class:"stat-icon"},Ks={class:"stat-info"},Qs={class:"stat-value"},Ws={class:"stat-item"},Xs={class:"stat-icon"},Ys={class:"stat-info"},Zs={class:"stat-value"},st={key:0,class:"stats-section admin-stats"},tt={class:"admin-grid"},et={class:"admin-stat-card"},at={class:"admin-stat-header"},ot={class:"admin-stat-content"},it={class:"admin-stat-row"},nt={class:"admin-stat-value"},lt={class:"admin-stat-row"},rt={class:"admin-stat-value"},dt={class:"admin-stat-row"},ct={class:"admin-stat-value"},ut={class:"admin-stat-row"},mt={class:"admin-stat-value"},vt={class:"admin-stat-card"},ft={class:"admin-stat-header"},_t={class:"admin-stat-content"},pt={class:"admin-stat-row"},wt={class:"admin-stat-value"},ht={class:"admin-stat-row"},yt={class:"admin-stat-value"},bt={class:"admin-stat-row"},gt={class:"admin-stat-value"},$t={class:"admin-stat-card"},Pt={class:"admin-stat-header"},St={class:"admin-stat-content"},Et={class:"admin-stat-row"},Vt={class:"admin-stat-value"},Ct={class:"admin-stat-row"},kt={class:"admin-stat-value"},Ut={class:"admin-stat-card"},Nt={class:"admin-stat-header"},zt={class:"admin-stat-content"},Mt={class:"admin-stat-row"},Lt={class:"admin-stat-value"},xt={class:"admin-stat-row"},Dt={class:"admin-stat-value"},Ft={key:0,class:"stats-section"},It={class:"role-distribution"},Rt={class:"role-label"},At={class:"role-count"},Tt={class:"role-legend"},Ot={class:"legend-text"},jt={key:1,class:"error-message"},Bt={key:2,class:"loading-message"},qt={__name:"ProfileStats",setup(F){const l=J();ts();const c=$(!1),D=$(null),P=$(""),U=$(null),m=$(null),p=R(()=>l.userRole==="admin"),y=R(()=>{const n=l.user;return!n||!n.is_active?"inactive":n.email_verified?"active":"unverified"}),b=R(()=>{const n=y.value;return{active:"Активен",inactive:"Не активен",unverified:"Не подтверждён"}[n]||"Unknown"}),h=n=>{if(!n)return"N/A";try{return new Date(n).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}catch{return"Неверная дата"}},S=n=>{if(!n)return"Никогда";try{const e=new Date(n),L=new Date-e,A=Math.floor(L/6e4),T=Math.floor(L/36e5),O=Math.floor(L/864e5);return A<1?"Только что":A<60?`${A} мин назад`:T<24?`${T} ч назад`:O<7?`${O} д назад`:h(n)}catch{return"Неверная дата"}},E=n=>n?n>=1e6?`${(n/1e6).toFixed(1)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toString():"0",d=async()=>{c.value=!0,P.value="";try{const n=l.token,e=await fetch("/api/stats/me",{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(e.ok){const w=await e.json();U.value=w.data}else throw new Error(`Failed to load user stats: ${e.status}`);if(p.value){const w=await fetch("/api/stats/admin",{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(w.ok){const L=await w.json();m.value=L.data}else console.warn("Failed to load admin stats, skipping...")}D.value=new Date}catch(n){console.error("Failed to load stats:",n),P.value="Unable to load statistics. Please try again later."}finally{c.value=!1}},u=async()=>{await d()};let g;return es(async()=>{await d(),g=setInterval(()=>{c.value||d()},300*1e3)}),ms(()=>{g&&clearInterval(g)}),(n,e)=>(_(),f("div",hs,[s("div",ys,[e[0]||(e[0]=s("h3",{class:"stats-title"},"Статистика",-1)),s("div",bs,[s("button",{class:"refresh-btn",onClick:u,disabled:c.value,title:D.value?`Last updated: ${S(D.value)}`:"Refresh"},[i(v,{name:"refresh",size:16,class:x({refreshing:c.value})},null,8,["class"])],8,gs)])]),s("div",$s,[s("div",Ps,[s("div",Ss,[s("div",Es,[i(v,{name:"user",size:20})]),s("div",Vs,[e[1]||(e[1]=s("div",{class:"stat-label"},"Статус аккаунта",-1)),s("div",Cs,[s("span",{class:x(`status-${y.value}`)},r(b.value),3)])])]),s("div",ks,[s("div",Us,[i(v,{name:"role",size:20})]),s("div",Ns,[e[2]||(e[2]=s("div",{class:"stat-label"},"Роль",-1)),s("div",zs,[s("span",{class:x(`role-badge role-${k(l).userRole}`)},r(k(l).userRole),3)])])]),s("div",Ms,[s("div",Ls,[i(v,{name:"calendar",size:20})]),s("div",xs,[e[3]||(e[3]=s("div",{class:"stat-label"},"Дата регистрации",-1)),s("div",Ds,r(h(U.value.user?.member_since)),1)])]),s("div",Fs,[s("div",Is,[i(v,{name:"login",size:20})]),s("div",Rs,[e[4]||(e[4]=s("div",{class:"stat-label"},"Последний вход",-1)),s("div",As,r(S(U.value?.user?.last_login)||"Never"),1)])])]),s("div",Ts,[e[8]||(e[8]=s("h4",{class:"section-title"},"Активность",-1)),s("div",Os,[s("div",js,[i(v,{name:"bell",size:20})]),s("div",Bs,[e[5]||(e[5]=s("div",{class:"stat-label"},"Непрочитанные уведомления",-1)),s("div",qs,[s("span",Js,r(U.value?.notifications?.unread||0),1)])])]),s("div",Hs,[s("div",Gs,[i(v,{name:"notification",size:20})]),s("div",Ks,[e[6]||(e[6]=s("div",{class:"stat-label"},"Всего уведомлений",-1)),s("div",Qs,r(U.value?.notifications?.total||0),1)])]),s("div",Ws,[s("div",Xs,[i(v,{name:"email",size:20})]),s("div",Ys,[e[7]||(e[7]=s("div",{class:"stat-label"},"Email",-1)),s("div",Zs,[s("span",{class:x(`email-status ${k(l).user?.email_verified?"Подтверждён":"Не подтверждён"}`)},r(k(l).user?.email_verified?"Подтверждён":"Не подтверждён"),3)])])])]),p.value&&m.value?(_(),f("div",st,[e[25]||(e[25]=s("h4",{class:"section-title"},"Системная информация",-1)),s("div",tt,[s("div",et,[s("div",at,[i(v,{name:"users",size:24,class:"admin-stat-icon"}),e[9]||(e[9]=s("h5",null,"Пользователи",-1))]),s("div",ot,[s("div",it,[e[10]||(e[10]=s("span",null,"Всего",-1)),s("span",nt,r(m.value.users?.total||0),1)]),s("div",lt,[e[11]||(e[11]=s("span",null,"Активные",-1)),s("span",rt,r(m.value.users?.active||0),1)]),s("div",dt,[e[12]||(e[12]=s("span",null,"Верифицированные",-1)),s("span",ct,r(m.value.users?.verified||0),1)]),s("div",ut,[e[13]||(e[13]=s("span",null,"Администраторы",-1)),s("span",mt,r(m.value.users?.admins||0),1)])])]),s("div",vt,[s("div",ft,[i(v,{name:"bell",size:24,class:"admin-stat-icon"}),e[14]||(e[14]=s("h5",null,"Уведомления",-1))]),s("div",_t,[s("div",pt,[e[15]||(e[15]=s("span",null,"Всего",-1)),s("span",wt,r(m.value.notifications?.total||0),1)]),s("div",ht,[e[16]||(e[16]=s("span",null,"Непрочитанные",-1)),s("span",yt,r(m.value.notifications?.unread||0),1)]),s("div",bt,[e[17]||(e[17]=s("span",null,"Получены сегодня",-1)),s("span",gt,r(m.value.notifications?.today||0),1)])])]),s("div",$t,[s("div",Pt,[i(v,{name:"database",size:24,class:"admin-stat-icon"}),e[18]||(e[18]=s("h5",null,"База данных",-1))]),s("div",St,[s("div",Et,[e[19]||(e[19]=s("span",null,"Таблицы",-1)),s("span",Vt,r(m.value.database?.table_count||0),1)]),s("div",Ct,[e[20]||(e[20]=s("span",null,"Всего строк",-1)),s("span",kt,r(E(m.value.database?.total_rows||0)),1)])])]),s("div",Ut,[s("div",Nt,[i(v,{name:"chart",size:24,class:"admin-stat-icon"}),e[21]||(e[21]=s("h5",null,"Сервер",-1))]),s("div",zt,[s("div",Mt,[e[22]||(e[22]=s("span",null,"Использование памяти",-1)),s("span",Lt,r(m.value.system?.memory_usage||"0%"),1)]),s("div",xt,[e[23]||(e[23]=s("span",null,"Время работы",-1)),s("span",Dt,r(m.value.system?.uptime||"0d"),1)])])])]),m.value.roles&&m.value.roles.length>0?(_(),f("div",Ft,[e[24]||(e[24]=s("h5",null,"Распределение пользователей по ролям",-1)),s("div",It,[(_(!0),f(H,null,G(m.value.roles,w=>(_(),f("div",{key:w.name,class:x(["role-item",`role-${w.name}`]),style:vs({width:`${w.percentage}%`})},[s("div",Rt,r(w.name),1),s("div",At,r(w.count),1)],6))),128))]),s("div",Tt,[(_(!0),f(H,null,G(m.value.roles,w=>(_(),f("div",{key:w.name,class:"legend-item"},[s("span",{class:x(["legend-color",`role-${w.name}`])},null,2),s("span",Ot,r(w.name)+": "+r(w.count)+" ("+r(w.percentage)+"%)",1)]))),128))])])):B("",!0)])):B("",!0),P.value?(_(),f("div",jt,[i(v,{name:"error",size:20}),s("span",null,r(P.value),1)])):B("",!0),c.value?(_(),f("div",Bt,[i(v,{name:"spinner",size:20,class:"spinning"}),e[26]||(e[26]=s("span",null,"Loading statistics...",-1))])):B("",!0)])]))}},Jt=ss(qt,[["__scopeId","data-v-cbdad86b"]]),Ht={class:"profile-page"},Gt={class:"container"},Kt={class:"profile-content"},Qt={class:"profile-sidebar"},Wt={class:"sidebar-nav"},Xt=["onClick"],Yt={class:"sidebar-label"},Zt={class:"sidebar-footer"},se={class:"profile-main"},te={key:0,class:"profile-tab"},ee={class:"avatar-section"},ae={class:"avatar-preview"},oe={class:"avatar-large"},ie={class:"avatar-text-large"},ne={class:"avatar-actions"},le={class:"form-grid"},re={class:"form-actions"},de={key:1,class:"profile-tab"},ce={class:"security-settings"},ue={class:"security-section"},me={class:"security-card-content"},ve={class:"security-card-header"},fe={class:"security-icon"},_e={class:"section-subtitle"},pe={class:"security-action"},we={class:"security-section"},he={class:"security-card-content"},ye={class:"security-card-header"},be={class:"security-icon"},ge={class:"security-title"},$e={class:"security-action"},Pe={key:2,class:"profile-tab"},Se={class:"users-table"},Ee={class:"table-header"},Ve={class:"table-search"},Ce={key:0,class:"table-loading"},ke={key:1,class:"table-container"},Ue={class:"table"},Ne={class:"user-cell"},ze={class:"user-info"},Me={class:"user-avatar-small"},Le={class:"avatar-text-small"},xe={class:"user-details"},De={class:"user-name"},Fe={key:0,class:"user-fullname"},Ie={class:"actions-cell"},Re=["onUpdate:modelValue","onChange","disabled"],Ae={key:3,class:"profile-tab"},Te={key:4,class:"profile-tab"},Oe={class:"tab-not-found"},je={class:"modal-actions"},Be={class:"current-email"},qe={class:"current-email-value"},Je={class:"modal-actions"},He={__name:"Profile",setup(F){const l=J(),c=ws(),D=ts(),P=$("info"),U=$(""),m=$(!1),p=$(!1),y=$("Unknown"),b=$(!1),h=async()=>{const a=await l.getLastPasswordChange();if(a.success&&a.data.lastPasswordChange){const t=new Date(a.data.lastPasswordChange);y.value=S(t)}},S=a=>{const o=Math.abs(new Date-a),V=Math.floor(o/(1e3*60*60*24)),W=Math.floor(o/(1e3*60*60)),X=Math.floor(o/(1e3*60));return V>30?`${Math.floor(V/30)} months ago`:V>0?`${V} day${V>1?"s":""} ago`:W>0?`${W} hour${W>1?"s":""} ago`:X>0?`${X} minute${X>1?"s":""} ago`:"Just now"},E=[{id:"info",label:"Информация профиля",icon:"user"},{id:"security",label:"Безопасность",icon:"security"},{id:"roles",label:"Управление ролями",icon:"roles"},{id:"profile_status",label:"Статистика",icon:"users"}],d=j({first_name:"",last_name:"",username:"",bio:""}),u=j({currentPassword:"",newPassword:"",confirmPassword:""}),g=j({currentPassword:"",newPassword:"",confirmPassword:""}),n=j({newEmail:"",currentPassword:""}),e=j({newEmail:"",currentPassword:""}),w=R(()=>{const a=l.user;if(!a)return"?";const t=a.first_name||"",o=a.last_name||"",V=a.username||"";return t&&o?`${t[0]}${o[0]}`.toUpperCase():t?t[0].toUpperCase():V?V[0].toUpperCase():"?"}),L=R(()=>{const a=l.user;return a?d.first_name!==(a.first_name||"")||d.last_name!==(a.last_name||"")||d.username!==(a.username||"")||d.bio!==(a.bio||""):!1}),A=R(()=>{if(!U.value)return c.users;const a=U.value.toLowerCase();return c.users.filter(t=>t.username&&t.username.toLowerCase().includes(a)||t.email.toLowerCase().includes(a)||t.first_name&&t.first_name.toLowerCase().includes(a)||t.last_name&&t.last_name.toLowerCase().includes(a))}),T=()=>{const a=l.user;a&&(d.first_name=a.first_name||"",d.last_name=a.last_name||"",d.username=a.username||"",d.bio=a.bio||"")},O=()=>{T()},as=async()=>{(await c.updateProfile(d)).success&&O()},os=()=>{let a=!0;return Object.keys(g).forEach(t=>g[t]=""),u.currentPassword||(g.currentPassword="Требуется ввести текущий пароль",a=!1),u.newPassword?u.newPassword.length<6&&(g.newPassword="Пароль должен состоять не менее чем из 6 символов.",a=!1):(g.newPassword="Требуется ввести новый пароль",a=!1),u.confirmPassword?u.newPassword!==u.confirmPassword&&(g.confirmPassword="Пароли не совпадают",a=!1):(g.confirmPassword="Пожалуйста, подтвердите свой пароль",a=!1),a},is=async()=>{if(!os())return;(await l.changePassword(u.currentPassword,u.newPassword)).success&&(u.currentPassword="",u.newPassword="",u.confirmPassword="",K(),await h(),D.addNotification({type:"success",title:"Готово!",message:"Пароль успешно изменен"}))},ns=()=>{let a=!0;return Object.keys(e).forEach(t=>e[t]=""),n.newEmail?/\S+@\S+\.\S+/.test(n.newEmail)||(e.newEmail="Пожалуйста, введите действительный адрес электронной почты",a=!1):(e.newEmail="Требуется ввести новый адрес электронной почты",a=!1),n.newEmail===l.user?.email&&(e.newEmail="Новый адрес электронной почты идентичен текущему.",a=!1),n.currentPassword||(e.currentPassword="Требуется ввести текущий пароль",a=!1),a},ls=async()=>{if(!ns())return;(await l.changeEmail(n.newEmail,n.currentPassword)).success?(n.newEmail="",n.currentPassword="",Q(),l.clearEmailChangeState(),D.addNotification({type:"success",title:"Готово!",message:"Адрес электронной почты успешно изменен. Пожалуйста, проверьте свой новый адрес электронной почты для подтверждения."})):e.newEmail=l.emailChangeError||"Не удалось изменить адрес электронной почты"},K=()=>{m.value=!1,u.currentPassword="",u.newPassword="",u.confirmPassword="",Object.keys(g).forEach(a=>g[a]="")},Q=()=>{p.value=!1,n.newEmail="",n.currentPassword="",Object.keys(e).forEach(a=>e[a]=""),l.clearEmailChangeState()},rs=a=>a.first_name&&a.last_name?`${a.first_name[0]}${a.last_name[0]}`.toUpperCase():a.first_name?a.first_name[0].toUpperCase():a.username?a.username[0].toUpperCase():a.email?a.email[0].toUpperCase():"?",ds=async(a,t)=>{await c.updateUserRole(a,t)};function cs(){b.value=!0}return fs(P,async a=>{a==="roles"&&l.userRole==="admin"&&await c.getAllUsers()}),es(()=>{T(),h()}),(a,t)=>(_(),f("div",Ht,[s("div",Gt,[t[30]||(t[30]=s("div",{class:"profile-header"},[s("h1",{class:"profile-title"},"Профиль"),s("p",{class:"profile-subtitle"},"Управление настройками учетной записи")],-1)),s("div",Kt,[s("div",Qt,[s("div",Wt,[(_(),f(H,null,G(E,o=>s("button",{key:o.id,class:x(["sidebar-item",{active:P.value===o.id}]),onClick:V=>P.value=o.id},[i(v,{name:o.icon,class:"sidebar-icon"},null,8,["name"]),s("span",Yt,r(o.label),1)],10,Xt)),64))]),s("div",Zt,[i(M,{fullWidth:"{{ true }}",variant:"outline",onClick:t[0]||(t[0]=o=>k(l).logout()),class:"mt-6"},{default:C(()=>[i(v,{name:"logout",size:24}),t[14]||(t[14]=z(" Выйти ",-1))]),_:1})])]),s("div",se,[P.value==="info"?(_(),f("div",te,[t[19]||(t[19]=s("div",{class:"tab-header"},[s("h2",{class:"tab-title"},"Информация профиля"),s("p",{class:"tab-subtitle"},"Обновите свои личные данные")],-1)),s("form",{onSubmit:Y(as,["prevent"]),class:"profile-form"},[s("div",ee,[s("div",ae,[s("div",oe,[s("span",ie,r(w.value),1)])]),s("div",ne,[i(M,{type:"button",variant:"outline",size:"sm",onClick:cs},{default:C(()=>[...t[15]||(t[15]=[z(" Загрузить фото ",-1)])]),_:1}),i(M,{type:"button",variant:"ghost",size:"sm"},{default:C(()=>[...t[16]||(t[16]=[z(" Удалить ",-1)])]),_:1})])]),s("div",le,[i(N,{modelValue:d.first_name,"onUpdate:modelValue":t[1]||(t[1]=o=>d.first_name=o),type:"text",label:"Имя",placeholder:"Введите ваше имя"},null,8,["modelValue"]),i(N,{modelValue:d.last_name,"onUpdate:modelValue":t[2]||(t[2]=o=>d.last_name=o),type:"text",label:"Фамилия",placeholder:"Введите вашу фамилию"},null,8,["modelValue"]),i(N,{modelValue:d.username,"onUpdate:modelValue":t[3]||(t[3]=o=>d.username=o),type:"text",label:"Псевдоним",placeholder:"Выберите имя пользователя"},null,8,["modelValue"]),i(N,{modelValue:d.bio,"onUpdate:modelValue":t[4]||(t[4]=o=>d.bio=o),type:"textarea",label:"О себе",placeholder:"Расскажите о себе.",rows:4},null,8,["modelValue"])]),s("div",re,[i(M,{type:"submit",loading:k(c).isLoading,disabled:!L.value},{default:C(()=>[...t[17]||(t[17]=[z(" Сохранить изменения ",-1)])]),_:1},8,["loading","disabled"]),i(M,{type:"button",variant:"ghost",onClick:O,disabled:!L.value},{default:C(()=>[...t[18]||(t[18]=[z(" Отмена ",-1)])]),_:1},8,["disabled"])])],32)])):P.value==="security"?(_(),f("div",de,[t[24]||(t[24]=s("div",{class:"tab-header"},[s("h2",{class:"tab-title"},"Настройки безопасности"),s("p",{class:"tab-subtitle"},"Управляйте своими паролями и электронной почтой.")],-1)),s("div",ce,[s("div",ue,[s("div",{class:"security-card",onClick:t[5]||(t[5]=o=>m.value=!0)},[s("div",me,[s("div",ve,[s("div",fe,[i(v,{name:"security",size:24})]),t[20]||(t[20]=s("div",{class:"section-title"},"Пароль",-1)),s("div",_e," Последнее изменение: "+r(y.value),1)]),t[21]||(t[21]=s("div",{class:"security-info"},[s("div",{class:"security-description"}," Нажмите, чтобы обновить пароль ")],-1))]),s("div",pe,[i(v,{name:"chevron-down",size:20})])])]),s("div",we,[s("div",{class:"security-card",onClick:t[6]||(t[6]=o=>p.value=!0)},[s("div",he,[s("div",ye,[s("div",be,[i(v,{name:"email",size:24})]),t[22]||(t[22]=s("div",{class:"section-title"},"Адрес электронной почты",-1)),s("div",ge,r(k(l).user?.email),1)]),t[23]||(t[23]=s("div",{class:"security-info"},[s("div",{class:"section-subtitle"}," Ваш основной адрес электронной почты для доступа к учетной записи "),s("div",{class:"security-description"}," Нажмите, чтобы изменить свой адрес электронной почты ")],-1))]),s("div",$e,[i(v,{name:"chevron-down",size:20})])])])])])):P.value==="roles"&&k(l).userRole==="admin"?(_(),f("div",Pe,[t[27]||(t[27]=s("div",{class:"tab-header"},[s("h2",{class:"tab-title"},"Управление ролями"),s("p",{class:"tab-subtitle"},"Управление ролями и правами пользователей.")],-1)),s("div",Se,[s("div",Ee,[s("div",Ve,[i(N,{modelValue:U.value,"onUpdate:modelValue":t[7]||(t[7]=o=>U.value=o),placeholder:"Поиск пользователей...",clearable:""},{prefix:C(()=>[i(v,{name:"search",size:16})]),_:1},8,["modelValue"])])]),k(c).isLoading?(_(),f("div",Ce," Загрузка пользователей... ")):(_(),f("div",ke,[s("table",Ue,[t[26]||(t[26]=s("thead",null,[s("tr",null,[s("th",null,"Пользователь"),s("th",null,"почта"),s("th",null,"Роль"),s("th",null,"Действия")])],-1)),s("tbody",null,[(_(!0),f(H,null,G(A.value,o=>(_(),f("tr",{key:o.id},[s("td",Ne,[s("div",ze,[s("div",Me,[s("span",Le,r(rs(o)),1)]),s("div",xe,[s("div",De,r(o.username),1),o.first_name||o.last_name?(_(),f("div",Fe,r(o.first_name)+" "+r(o.last_name),1)):B("",!0)])])]),s("td",null,r(o.email),1),s("td",null,[s("span",{class:x(`role-badge role-${o.role}`)},r(o.role),3)]),s("td",Ie,[_s(s("select",{"onUpdate:modelValue":V=>o.role=V,onChange:V=>ds(o.id,o.role),class:"role-select",disabled:o.id===k(l).user?.id},[...t[25]||(t[25]=[s("option",{value:"user"},"User",-1),s("option",{value:"moderator"},"Moderator",-1),s("option",{value:"admin"},"Admin",-1)])],40,Re),[[ps,o.role]])])]))),128))])])]))])])):P.value==="profile_status"?(_(),f("div",Ae,[i(Jt)])):(_(),f("div",Te,[s("div",Oe,[i(v,{name:"error",size:64,color:"var(--color-gray-300)"}),t[28]||(t[28]=s("h3",null,"Раздел не доступен",-1)),t[29]||(t[29]=s("p",null,"Для доступа в раздел необходим повышенный доступ.",-1))])]))])])]),i(Z,{show:m.value,title:"Изменить пароль",size:"md",onClose:K},{default:C(()=>[s("form",{onSubmit:Y(is,["prevent"]),class:"modal-form"},[i(N,{modelValue:u.currentPassword,"onUpdate:modelValue":t[8]||(t[8]=o=>u.currentPassword=o),type:"password",label:"Текущий пароль",placeholder:"Введите текущий пароль",error:g.currentPassword,required:""},null,8,["modelValue","error"]),i(N,{modelValue:u.newPassword,"onUpdate:modelValue":t[9]||(t[9]=o=>u.newPassword=o),type:"password",label:"Новый пароль",placeholder:"Введите новый пароль",error:g.newPassword,required:""},null,8,["modelValue","error"]),i(N,{modelValue:u.confirmPassword,"onUpdate:modelValue":t[10]||(t[10]=o=>u.confirmPassword=o),type:"password",label:"Подтвердите новый пароль",placeholder:"Подтвердите новый пароль",error:g.confirmPassword,required:""},null,8,["modelValue","error"]),s("div",je,[i(M,{type:"submit",loading:k(l).isLoading},{default:C(()=>[...t[31]||(t[31]=[z(" Изменить пароль ",-1)])]),_:1},8,["loading"]),i(M,{type:"button",variant:"ghost",onClick:K},{default:C(()=>[...t[32]||(t[32]=[z(" Cancel ",-1)])]),_:1})])],32)]),_:1},8,["show"]),i(Z,{show:p.value,"onUpdate:show":t[13]||(t[13]=o=>p.value=o),title:"Изменить Email",size:"md",onClose:Q},{default:C(()=>[s("form",{onSubmit:Y(ls,["prevent"]),class:"modal-form"},[s("div",Be,[t[33]||(t[33]=s("div",{class:"current-email-label"},"Текущий Email:",-1)),s("div",qe,r(k(l).user?.email),1)]),i(N,{modelValue:n.newEmail,"onUpdate:modelValue":t[11]||(t[11]=o=>n.newEmail=o),type:"email",label:"Новый Email",placeholder:"Введите новый email address",error:e.newEmail,required:""},null,8,["modelValue","error"]),i(N,{modelValue:n.currentPassword,"onUpdate:modelValue":t[12]||(t[12]=o=>n.currentPassword=o),type:"password",label:"Пароль",placeholder:"Введите пароль для подтверждения",error:e.currentPassword,required:""},null,8,["modelValue","error"]),s("div",Je,[i(M,{type:"submit",loading:a.emailLoading},{default:C(()=>[...t[34]||(t[34]=[z(" Подтвердить ",-1)])]),_:1},8,["loading"]),i(M,{type:"button",variant:"ghost",onClick:Q},{default:C(()=>[...t[35]||(t[35]=[z(" Закрыть ",-1)])]),_:1})])],32)]),_:1},8,["show"])]))}},We=ss(He,[["__scopeId","data-v-65f1fd39"]]);export{We as default};
